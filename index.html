<!DOCTYPE html>
<html lang="zh-HK">
<head>
  <meta charset="UTF-8" />
  <title>AR Model 調整器（Enter 送出文字）</title>
  <script src="https://cdn.jsdelivr.net/npm/aframe@1.4.2/dist/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.css" />
  <style>
    html, body {
      margin: 0; padding: 0; height: 100%; overflow: hidden; background: transparent;
      font-family: sans-serif;
    }
    #modelControls {
      position: fixed; bottom: 10px; left: 10px; width: 320px;
      background: rgba(255,255,255,0.9);
      padding: 10px; border-radius: 8px;
      font-size: 14px; user-select: none;
      box-shadow: 0 0 8px rgba(0,0,0,0.3);
      max-height: 50vh; overflow-y: auto;
      z-index: 9999;
    }
    #modelControls label {
      display: block; margin: 8px 0 2px;
    }
    #modelControls input[type=range] {
      width: 100%;
    }
    .value-display {
      font-size: 12px; color: #444; margin-bottom: 6px;
      user-select: text;
    }
    #textControls {
      position: fixed; bottom: 10px; right: 10px; width: 320px;
      background: rgba(255,255,255,0.9);
      padding: 10px; border-radius: 8px;
      font-size: 14px; user-select: none;
      box-shadow: 0 0 8px rgba(0,0,0,0.3);
      max-height: 50vh; overflow-y: auto;
      z-index: 9999;
    }
    #textControls label {
      font-weight: bold;
      display: block;
      margin-bottom: 6px;
    }
    #textInput {
      width: 100%;
      height: 120px;
      font-size: 14px;
      padding: 6px 8px;
      resize: vertical;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
      font-family: monospace, monospace;
    }
  </style>
</head>
<body>
  <a-scene 
    mindar-image="imageTargetSrc: cat-marker.mind; autoStart: true; uiLoading: no;"
    vr-mode-ui="enabled: false"
    device-orientation-permission-ui="enabled: true"
    embedded
    renderer="colorManagement: true, physicallyCorrectLights: true, alpha: true"
  >
    <a-assets>
      <a-asset-item id="model" src="cat.glb"></a-asset-item>
    </a-assets>

    <a-camera id="camera" position="0 0 0" look-controls="enabled: false"></a-camera>

    <a-entity mindar-image-target="targetIndex: 0" id="marker">
      <a-gltf-model id="arModel" src="#model" position="0 0 0" rotation="0 180 0" scale="0.2 0.2 0.2"></a-gltf-model>
      
      <!-- 文字框 -->
      <a-text id="arText"
        value="請輸入文字"
        color="#fff"
        align="center"
        width="1.5"
        position="0 0.3 0"
        rotation="0 180 0"
        wrap-count="30"
        >
      </a-text>
    </a-entity>
  </a-scene>

  <!-- 模型調整控制區 -->
  <div id="modelControls">
    <strong>調整模型位置 / 旋轉 / 大小</strong>

    <label for="posX">位置 X</label>
    <input type="range" id="posX" min="-1" max="1" step="0.01" value="0">
    <div class="value-display" id="posX_val">0</div>

    <label for="posY">位置 Y</label>
    <input type="range" id="posY" min="-1" max="1" step="0.01" value="0">
    <div class="value-display" id="posY_val">0</div>

    <label for="posZ">位置 Z</label>
    <input type="range" id="posZ" min="-1" max="1" step="0.01" value="0">
    <div class="value-display" id="posZ_val">0</div>

    <label for="rotX">旋轉 X (度)</label>
    <input type="range" id="rotX" min="0" max="360" step="1" value="0">
    <div class="value-display" id="rotX_val">0</div>

    <label for="rotY">旋轉 Y (度)</label>
    <input type="range" id="rotY" min="0" max="360" step="1" value="180">
    <div class="value-display" id="rotY_val">180</div>

    <label for="rotZ">旋轉 Z (度)</label>
    <input type="range" id="rotZ" min="0" max="360" step="1" value="0">
    <div class="value-display" id="rotZ_val">0</div>

    <label for="scale">大小 (等比縮放)</label>
    <input type="range" id="scale" min="0.01" max="1" step="0.01" value="0.2">
    <div class="value-display" id="scale_val">0.20</div>
  </div>

  <!-- 文字輸入控制區 -->
  <div id="textControls">
    <label for="textInput">AR 文字框內容（按 Enter 送出）</label>
    <textarea id="textInput" placeholder="輸入留言，按 Enter 即送出文字"></textarea>
  </div>

  <script>
    const model = document.getElementById('arModel');

    const posX = document.getElementById('posX');
    const posY = document.getElementById('posY');
    const posZ = document.getElementById('posZ');
    const rotX = document.getElementById('rotX');
    const rotY = document.getElementById('rotY');
    const rotZ = document.getElementById('rotZ');
    const scale = document.getElementById('scale');

    const posX_val = document.getElementById('posX_val');
    const posY_val = document.getElementById('posY_val');
    const posZ_val = document.getElementById('posZ_val');
    const rotX_val = document.getElementById('rotX_val');
    const rotY_val = document.getElementById('rotY_val');
    const rotZ_val = document.getElementById('rotZ_val');
    const scale_val = document.getElementById('scale_val');

    const arText = document.getElementById('arText');
    const textInput = document.getElementById('textInput');

    function updateModel() {
      model.setAttribute('position', `${posX.value} ${posY.value} ${posZ.value}`);
      model.setAttribute('rotation', `${rotX.value} ${rotY.value} ${rotZ.value}`);
      model.setAttribute('scale', `${scale.value} ${scale.value} ${scale.value}`);

      posX_val.textContent = posX.value;
      posY_val.textContent = posY.value;
      posZ_val.textContent = posZ.value;
      rotX_val.textContent = rotX.value;
      rotY_val.textContent = rotY.value;
      rotZ_val.textContent = rotZ.value;
      scale_val.textContent = parseFloat(scale.value).toFixed(2);
    }

    // 文字框 Enter 送出事件
    textInput.addEventListener('keydown', (event) => {
      if (event.key === 'Enter') {
        event.preventDefault(); // 阻止換行
        const value = textInput.value.trim();
        if (value.length > 0) {
          arText.setAttribute('value', value);
          // 想清空輸入框可以取消以下註解：
          // textInput.value = '';
        }
      }
    });

    posX.addEventListener('input', updateModel);
    posY.addEventListener('input', updateModel);
    posZ.addEventListener('input', updateModel);
    rotX.addEventListener('input', updateModel);
    rotY.addEventListener('input', updateModel);
    rotZ.addEventListener('input', updateModel);
    scale.addEventListener('input', updateModel);

    updateModel();
  </script>
</body>
</html>
